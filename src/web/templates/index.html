<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente de Proyectos de Inversión</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a;
        }
        .chat-container {
            height: calc(100vh - 200px);
            background-color: #2d2d2d;
            border-radius: 12px;
            padding: 1rem;
        }
        .message {
            max-width: 80%;
            margin: 10px;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.3s ease-in-out;
        }
        .user-message {
            background-color: #3b82f6;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }
        .bot-message {
            background-color: #374151;
            color: #e5e7eb;
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .input-container {
            background-color: #2d2d2d;
            border-radius: 12px;
            padding: 0.5rem;
            margin-top: 1rem;
        }
        .custom-input {
            background-color: #374151;
            color: #e5e7eb;
            border: 1px solid #4b5563;
        }
        .custom-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }
        .custom-button {
            background-color: #3b82f6;
            transition: all 0.2s ease-in-out;
        }
        .custom-button:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
        }
        .custom-button:active {
            transform: translateY(0);
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="bg-gray-900 rounded-xl shadow-2xl p-6">
            <h1 class="text-2xl font-bold text-center mb-6 text-blue-400">
                Asistente de Proyectos de Inversión
            </h1>
            
            <div id="chat-messages" class="chat-container overflow-y-auto mb-4">
                <!-- Los mensajes se agregarán aquí dinámicamente -->
            </div>

            <div class="input-container flex gap-2">
                <input type="text" id="user-input" 
                       class="custom-input flex-1 p-3 rounded-lg focus:outline-none"
                       placeholder="Escribe tu mensaje aquí...">
                <button onclick="sendMessage()" 
                        class="custom-button text-white px-6 py-3 rounded-lg font-medium">
                    Enviar
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 'initial';
        let userResponses = {};

        const affirmativeResponses = ['si', 'sí', 'claro', 'de acuerdo', 'correcto', 'ok', 'okay', 'por supuesto', 'afirmativo'];
        const negativeResponses = ['no', 'negativo', 'cancelar', 'terminar'];

        function isAffirmativeResponse(message) {
            return affirmativeResponses.includes(message.toLowerCase().trim());
        }

        function isNegativeResponse(message) {
            return negativeResponses.includes(message.toLowerCase().trim());
        }

        function addMessage(message, isUser = false) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            
            // Handle multiline messages
            message = message.replace(/\n/g, '<br>');
            messageDiv.innerHTML = message;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function handleInitialResponse(message) {
            if (isAffirmativeResponse(message)) {
                addMessage('A continuación, se iniciará un módulo de preguntas asociado a proyectos de inversión, según la metodología general ajustada (MGA) del Departamento Nacional de Planeación.');
                addMessage('Por favor, ingrese el nombre de la entidad pública:');
                currentStep = 'entidad_nombre';
            } else if (isNegativeResponse(message)) {
                addMessage('Gracias por comunicarte con nosotros. Recuerda que si deseas ayuda en el futuro, solo escríbenos.');
                currentStep = 'end';
            } else {
                addMessage('Por favor, responda con "Sí" o "No".');
            }
        }

        function handleEntityName(message) {
            userResponses.entidad_nombre = message;
            addMessage('¿A qué sector pertenece la entidad?');
            currentStep = 'entidad_sector';
        }

        function handleEntitySector(message) {
            userResponses.entidad_sector = message;
            addMessage('Seleccione los componentes del IDEC que desea incluir en su proyecto de inversión (puede seleccionar múltiples opciones):\n\n' +
                      '1. Gobernanza de datos\n' +
                      '2. Interoperabilidad\n' +
                      '3. Herramientas técnicas y tecnológicas\n' +
                      '4. Seguridad y privacidad de datos\n' +
                      '5. Datos\n' +
                      '6. Aprovechamiento de datos\n\n' +
                      'Por favor, indique los números de las opciones seleccionadas separados por comas (ejemplo: 1,3,5):');
            currentStep = 'componentes_idec';
        }

        function handleComponentesIDEC(message) {
            userResponses.componentes_idec = message;
            addMessage('Por favor, describa el problema general u oportunidad que desea resolver:');
            currentStep = 'problema_descripcion';
        }

        function handleProblemaDescripcion(message) {
            userResponses.problema_descripcion = message;
            addMessage('Describa la situación actual:');
            currentStep = 'situacion_actual';
        }

        function handleSituacionActual(message) {
            userResponses.situacion_actual = message;
            addMessage('Describa las causas y efectos del problema:');
            currentStep = 'causas_efectos';
        }

        function handleCausasEfectos(message) {
            userResponses.causas_efectos = message;
            addMessage('Seleccione las causas posibles (puede seleccionar múltiples opciones):\n\n' +
                      '1. Baja cobertura de conectividad en hogares\n' +
                      '2. Bajo uso y apropiación de las TIC\n\n' +
                      'Por favor, indique los números de las opciones seleccionadas separados por comas:');
            currentStep = 'causas_posibles';
        }

        function handleCausasPosibles(message) {
            userResponses.causas_posibles = message;
            addMessage('Seleccione los efectos posibles (puede seleccionar múltiples opciones):\n\n' +
                      '1. Limitado acceso a contenidos virtuales, bienes y servicios digitales\n' +
                      '2. Bajo acceso a trámites y servicios en línea\n\n' +
                      'Por favor, indique los números de las opciones seleccionadas separados por comas:');
            currentStep = 'efectos_posibles';
        }

        function handleEfectosPosibles(message) {
            userResponses.efectos_posibles = message;
            addMessage('Describa la población afectada (cantidad y tipo):');
            currentStep = 'poblacion_afectada';
        }

        function handlePoblacionAfectada(message) {
            userResponses.poblacion_afectada = message;
            addMessage('Describa la población objetivo (cantidad y tipo):');
            currentStep = 'poblacion_objetivo';
        }

        function handlePoblacionObjetivo(message) {
            userResponses.poblacion_objetivo = message;
            addMessage('Describa el objetivo general del proyecto:');
            currentStep = 'objetivo_general';
        }

        function handleObjetivoGeneral(message) {
            userResponses.objetivo_general = message;
            addMessage('Describa los objetivos específicos del proyecto:');
            currentStep = 'objetivos_especificos';
        }

        function handleObjetivosEspecificos(message) {
            userResponses.objetivos_especificos = message;
            addMessage('Describa la localización del proyecto (ejemplo: Territorial - Territorio Norte, Nacional - Colombia, Departamental - Cundinamarca):');
            currentStep = 'localizacion';
        }

        function handleLocalizacion(message) {
            userResponses.localizacion = message;
            addMessage('Describa el marco lógico del proyecto:');
            currentStep = 'marco_logico';
        }

        function handleMarcoLogico(message) {
            userResponses.marco_logico = message;
            addMessage('Describa la cadena de valor:');
            currentStep = 'cadena_valor';
        }

        function handleCadenaValor(message) {
            userResponses.cadena_valor = message;
            addMessage('Describa las alternativas de solución identificadas:');
            currentStep = 'alternativas_solucion';
        }

        function handleAlternativasSolucion(message) {
            userResponses.alternativas_solucion = message;
            addMessage('Describa los riesgos identificados:');
            currentStep = 'riesgos';
        }

        function handleRiesgos(message) {
            userResponses.riesgos = message;
            addMessage('Describa la estrategia de sostenibilidad:');
            currentStep = 'sostenibilidad';
        }

        function handleSostenibilidad(message) {
            userResponses.sostenibilidad = message;
            addMessage('Describa la cuantificación y valoración de beneficios:');
            currentStep = 'beneficios';
        }

        function handleBeneficios(message) {
            userResponses.beneficios = message;
            addMessage('Describa los indicadores de gestión, producto o impacto:');
            currentStep = 'indicadores';
        }

        function handleIndicadores(message) {
            userResponses.indicadores = message;
            addMessage('Describa el presupuesto total por tipo (CapEx, OpEx, promoción):');
            currentStep = 'presupuesto_total';
        }

        function handlePresupuestoTotal(message) {
            userResponses.presupuesto_total = message;
            addMessage('Describa el detalle por actividad (nombre de actividad y valor unitario asignado):');
            currentStep = 'presupuesto_detalle';
        }

        function handlePresupuestoDetalle(message) {
            userResponses.presupuesto_detalle = message;
            addMessage('¡Gracias por completar el formulario! Sus respuestas han sido registradas.');
            currentStep = 'end';
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            
            if (!message) return;

            // Mostrar mensaje del usuario
            addMessage(message, true);
            input.value = '';

            // Manejar la respuesta según el paso actual
            switch(currentStep) {
                case 'initial':
                    handleInitialResponse(message);
                    break;
                case 'entidad_nombre':
                    handleEntityName(message);
                    break;
                case 'entidad_sector':
                    handleEntitySector(message);
                    break;
                case 'componentes_idec':
                    handleComponentesIDEC(message);
                    break;
                case 'problema_descripcion':
                    handleProblemaDescripcion(message);
                    break;
                case 'situacion_actual':
                    handleSituacionActual(message);
                    break;
                case 'causas_efectos':
                    handleCausasEfectos(message);
                    break;
                case 'causas_posibles':
                    handleCausasPosibles(message);
                    break;
                case 'efectos_posibles':
                    handleEfectosPosibles(message);
                    break;
                case 'poblacion_afectada':
                    handlePoblacionAfectada(message);
                    break;
                case 'poblacion_objetivo':
                    handlePoblacionObjetivo(message);
                    break;
                case 'objetivo_general':
                    handleObjetivoGeneral(message);
                    break;
                case 'objetivos_especificos':
                    handleObjetivosEspecificos(message);
                    break;
                case 'localizacion':
                    handleLocalizacion(message);
                    break;
                case 'marco_logico':
                    handleMarcoLogico(message);
                    break;
                case 'cadena_valor':
                    handleCadenaValor(message);
                    break;
                case 'alternativas_solucion':
                    handleAlternativasSolucion(message);
                    break;
                case 'riesgos':
                    handleRiesgos(message);
                    break;
                case 'sostenibilidad':
                    handleSostenibilidad(message);
                    break;
                case 'beneficios':
                    handleBeneficios(message);
                    break;
                case 'indicadores':
                    handleIndicadores(message);
                    break;
                case 'presupuesto_total':
                    handlePresupuestoTotal(message);
                    break;
                case 'presupuesto_detalle':
                    handlePresupuestoDetalle(message);
                    break;
                case 'end':
                    // No hacer nada en el paso final
                    break;
            }
        }

        // Permitir enviar mensaje con Enter
        document.getElementById('user-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Mensaje inicial
        window.onload = function() {
            addMessage('¿Desea construir un plan de inversión asociado a la temática de Infraestructura de Datos (IDEC)?');
        };
    </script>
</body>
</html> 